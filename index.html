<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuestro primer a√±o ‚ù§Ô∏è</title>

  <!-- IMPORTANTE: sube el n√∫mero v cuando cambies el CSS para forzar actualizaci√≥n -->
  <link rel="stylesheet" href="./styles.css?v=12">

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Fondo part√≠culas -->
  <canvas id="stars" aria-hidden="true"></canvas>

  <div class="bg"></div>

  <!-- Confeti (overlay) -->
  <canvas id="confetti" aria-hidden="true"></canvas>

  <main class="book">

    <!-- P√ÅGINA 0: EMPEZAR -->
    <section class="page active" data-title="Empezar">
      <div class="event hero-card">
        <h1>Nuestro primer a√±o ‚ù§Ô∏è</h1>
        <p class="hero-sub">Para Alicia ‚ù§Ô∏è</p>

        <button id="startBtn" class="btn btn-primary" type="button">EMPEZAR</button>

        <p class="hero-hint">Pulsa ‚ÄúEMPEZAR‚Äù para empezar a pasar p√°ginas ‚ú®</p>
      </div>
    </section>

    <!-- P√ÅGINA 1: PORTADA -->
    <section class="page" data-title="Portada">
      <div class="event" id="coverEasterEgg">
        <h3>Feliz primer a√±o juntos Ali ‚ù§Ô∏è</h3>
        <img class="event-photo" src="./foto1.jpeg" alt="feliz primer a√±o juntos Ali ‚ù§Ô∏è" />
        <p>Esto es solo una peque√±a dedicatoria de como ha surgido todo y de nuestro recorrido, espero que te guste ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è</p>

        <p class="easter-hint"></p>
      </div>
    </section>

    <!-- P√ÅGINA 2 -->
    <section class="page" data-title="El d√≠a que me llamaste la atenci√≥n">
      <div class="event">
        <h3>‚ú® El d√≠a que me llamaste la atenci√≥n</h3>
        <img class="event-photo" src="./foto5.jpg" alt="El d√≠a que me llamaste la atenci√≥n" />
        <hr class="divider" />
        <img class="event-photo" src="./foto6.jpg" alt="El d√≠a que me llamaste la atenci√≥n" />
        <p>(Escribe aqu√≠ qu√© pas√≥ ese d√≠a. Qu√© viste en ella, qu√© pensaste, qu√© detalle te marc√≥.)</p>

        <!-- FLIP CARD (ejemplo): copia/pega esta tarjeta donde quieras -->
        <div class="flip-wrap">
          <div class="flip" data-flip>
            <div class="flip-face flip-front">
              <h4>üíå Un mini-recuerdo</h4>
              <p>Te quiero mucho</p>
              <small></small>
            </div>
            <div class="flip-face flip-back">
              <h4>‚ú®</h4>
              <p>Si ves esto me debes lo que yo diga</p>
              <small></small>
            </div>
          </div>
          <p class="flip-hint"></p>
        </div>
      </div>
    </section>

    <!-- P√ÅGINA 3 -->
    <section class="page" data-title="Cuando empezamos a hablar semanalmente">
      <div class="event">
        <h3>üí¨ Cuando empezamos a hablar semanalmente</h3>
        <p>(Cuenta c√≥mo se volvi√≥ ‚Äúnormal‚Äù hablar, c√≥mo te sent√≠as esperando sus mensajes, qu√© os uni√≥.)</p>
      </div>
    </section>

    <!-- P√ÅGINA 4 -->
    <section class="page" data-title="Cuando me di cuenta que sent√≠a AMOR">
      <div class="event">
        <h3>‚ù§Ô∏è Cuando me di cuenta que sent√≠a por primera vez AMOR</h3>
        <p>(Aqu√≠ va el momento exacto: d√≥nde estabas, qu√© pensaste, por qu√© supiste que era amor de verdad.)</p>
      </div>
    </section>

    <!-- P√ÅGINA 5: LA PRIMERA VEZ (con fotos al lateral + caption debajo) -->
    <section class="page" data-title="La primera vez que quedamos">
      <div class="event letter-event">
        <h3>La primera vez que quedamos</h3>

        <div class="date-wrap">
          <!-- TEXTO -->
          <div class="date-text">
            <p>Esa semana la tengo grabada. Te lo dije la semana anterior: que quer√≠a quedar contigo para intentar hacer algo y que te enamorases de m√≠ (claro, yo no sab√≠a que ya te gustaba).</p>

            <p>Yo me acuerdo de estar todos los d√≠as muerto de dolor de barriga, de los nervios y de mariposas. Pero fue justo cuando fuimos a Vizzio cuando se me quitaron las dudas que ten√≠a sobre si todo iba a salir bien o no. Porque esa noche yo te estuve mirando todo el tiempo: no te apart√© la mirada ni un solo momento. Para m√≠ era la primera vez que sent√≠a algo tan fuerte sin ser absolutamente nada m√°s que amigos.</p>

            <p>Qu√© risa cuando me sal√≠ a la terraza con Kostadin y empec√© a hablar de ti, sobre c√≥mo no sab√≠a qu√© hacer porque estaba sintiendo tanto solo por estar CERCA DE TI, que el t√≠o se levant√≥ y me dijo: ‚Äúno seas un cag√≥n‚Äù. Y creo que, supongo, que gracias a eso fue que fui directo hacia ti, te cog√≠ de la mano y por segunda vez nos besamos. No te imaginas lo que estaba sintiendo en ese momento: no me estaba preocupando por nada, solo en sentir tu beso al m√°ximo para poder recordarlo.</p>

            <p>Fue ah√≠ cuando ya sab√≠a que daba igual que me odiases, acabase cay√©ndote mal o simplemente nos separase la vida: iba a hacer absolutamente todo por perseguirte y conseguir estar a tu lado.</p>

            <p>Dos d√≠as despu√©s lleg√≥ por fin nuestra PRIMERA CITA. Yo estaba muerto por dentro; no sab√≠a si tomarme 15 valerianas o simplemente morir. Me acuerdo de ir por la ma√±ana al mercado del Tiro de L√≠nea para comprar los tulipanes rojos que hab√≠a reservado de antemano, y nada m√°s llegar a casa mi madre gritar diciendo: ‚ÄúSe nos hace mayor‚Äù.</p>

            <p>Pero no solo me dijo eso, claro. Me dijo que esos tulipanes no eran suficientes y que el ramo ten√≠a que ser m√°s grande. As√≠ que, para que veas, fue idea de MI MADRE comprar tambi√©n las rosas y unirlas en un ramo.</p>

            <p>Fuimos al Costco mi padre y yo en coche, y me estuvo dando una charla de c√≥mo era todo esto tan repentino: qui√©n eras, si eras guapa, si estaba enamorado de ti. Le cont√© absolutamente todo, muerto de verg√ºenza, claro, que hasta se estaba riendo de la cara de tomate que ten√≠a. Pero bueno, al final me aconsej√≥ y me dijo una cosa que creo que fue muy importante para m√≠: ‚Äúpase lo que pase con esta chica, disfr√∫talo, e intenta no abrumarla mucho, que te conozco‚Äù JAJAJAJA.</p>

            <p>Puede que tuviese bastante raz√≥n en lo de abrumar‚Ä¶ pero tambi√©n ten√≠a mucha, mucha m√°s raz√≥n en lo de disfrutar, porque creo que no he disfrutado m√°s en mi vida.</p>

            <p>Bueno, que me voy por las ramas. Al final acabamos comprando 20 rosas de color rosa porque sab√≠a que las rojas t√∫ las odiabas. Entonces tuvimos que buscar unas rosas y tuvimos suerte porque justo quedaba solo un ramo de color rosa. Ya en casa, despu√©s de comprar todo, ah√≠ fue la primera vez que mi madre me ense√±√≥ a hacer un arreglo de flores. Y la verdad es que no entend√≠ nada, pero me serv√≠a para d√°rtelo.</p>

            <p>Y por fin lleg√≥ el momento que llevaba esperando tantos meses: quedar contigo sinti√©ndome completamente enamorado de ti, y creyendo que t√∫ tambi√©n sent√≠as lo mismo.</p>

            <p>Fui al metro a recogerte. Recuerdo la chaqueta que ten√≠as puesta y el paro card√≠aco que me dio al verte, porque estabas GUAP√çSIMA. En el camino a mi casa no sab√≠a ni c√≥mo mirarte a la cara; no paraba de mirar al frente porque es que no era capaz. Pero al menos fui capaz de darte un beso en la mejilla.</p>

            <p>Estaba tan nervioso y cagado por dentro que pensaba que lo mejor para romper el hielo era sacar a mi perro juntos‚Ä¶ pero bueno, por lo menos eso dur√≥ poquito.</p>

            <p>Y BUAAAAAA, POR FIN, cuando volvimos a mi casa ten√≠a el ramo escondido en la cocina esperando para d√°rtelo con ganas. Y cuando te lo di‚Ä¶ TU CARA. LA CARA DE SORPRESA. DE ASOMBRO. ME ENCANT√ì.</p>

            <p>Ah√≠ ya perd√≠ por completo los nervios y me dej√© simplemente disfrutar el momento sin miedo ni nervios. Nos sentamos en el sof√°, te expliqu√© m√°s o menos r√°pidamente todo el plan que ten√≠a y quer√≠a hacer contigo con las flores, y simplemente me acerqu√© a ti‚Ä¶ y te bes√©. Creo que estaba sinti√©ndome tan pero tan‚Ä¶ NO S√â, ¬øBIEN? Pero fue lo mejor de mi vida.</p>

            <p>Despu√©s ya solo estaba en el mood de felicidad absoluta de siempre. Iba s√∫per contento, habl√°ndote del restaurante, y acabamos comiendo bastante bien (t√∫ poca comida; en el momento me extra√±√© y pensaba que no te gustaba, pero he ido aprendiendo que simplemente no comes tanto).</p>

            <p>Terminamos de comer, subimos a mi casa, te di el ramo de flores y te acompa√±√© al metro de vuelta. Me daba tanta risa y tanta relajaci√≥n que todo hubiese salido como hab√≠a planeado‚Ä¶ lo estaba disfrutando todo al m√°ximo. Y ah√≠ lo √∫ltimo que tambi√©n me encant√≥ fue bajar las escaleras del metro contigo y despedirme bes√°ndote entera e intentando recordar ese beso.</p>

            <p>Volv√≠ a mi casa literalmente dando saltos como en las pel√≠culas JAJAJAJAJAJAJA.</p>

            <p>Me met√≠ en la cama intentando procesar todo lo que hab√≠a pasado y flipando con lo guapa que estabas. Llegaron mis padres y como locos me empezaron a preguntar que c√≥mo hab√≠a ido todo, y estaba tan, tan, tan feliz / nervioso / procesando todo, que me satur√© y no pude decir nada. Lo tuve que decir todo al d√≠a siguiente.</p>

            <p>Definitivamente, un d√≠a que nunca se me va a ir de mi cabeza jam√°s, pero jam√°s, jam√°s. Me encant√≥ todo, y gracias a ti todo sali√≥ bien.</p>
          </div>

          <!-- FOTOS LATERAL + TEXTO DEBAJO -->
          <div class="date-photos">
            <figure class="side-figure">
              <img class="side-photo" src="./foto9.jpeg" alt="La primera vez que quedamos - flores" />
              <figcaption class="side-caption">El primer ramo de flores que doy en mi vida, tuyo</figcaption>
            </figure>

            <figure class="side-figure">
              <img class="side-photo" src="./foto8.jpeg" alt="Mensaje del d√≠a siguiente" />
              <figcaption class="side-caption">Este mensaje es lo que le escrib√≠ a F√°tima al d√≠a siguiente</figcaption>
            </figure>
          </div>
        </div>
      </div>
    </section>

    <!-- P√ÅGINA 6 -->
    <section class="page" data-title="Novios">
      <div class="event">
        <h3>üíû Novios üíû</h3>
        <p>(C√≥mo fue, c√≥mo lo pedisteis o c√≥mo se dio, qu√© sentiste, qu√© cambi√≥ a partir de ah√≠.)</p>
      </div>
    </section>

    <!-- P√ÅGINA 7: (√öLTIMO EVENTO) NUESTRA RELACI√ìN -->
    <section class="page" data-title="Nuestra relaci√≥n">
      <div class="event letter-event">
        <h3>üåô Nuestra relaci√≥n</h3>

        <div class="relation-wrap">
          <div class="relation-text">
            <p>Ali,</p>

            <p>No s√© muy bien por d√≥nde empezar, s√© que hemos estado teniendo unos meses algo raretes y un poco complicados, se nos han mezclado muchas cosas, y no hemos sabido afrontarlo tan bien como podr√≠amos haberlo hecho, pero creo que no pasa nada al fin y al cabo seguimos siendo nuevos en esto de tener un relaci√≥n, asi que s√© que todo va a ir hacia arriba. Igualmente para animar las cosas un poco, quer√≠a regalarte algo que no se pueda guardar en una caja, algo que puedas leer cuando quieras recordar lo que somos y lo que elegimos cada d√≠a.</p>

            <p>Quiero que nunca pienses que nadie te ama, porque no te puedes hacer una idea lo que eres para mi, si lo necesitases me arrancar√° el coraz√≥n y te lo dar√≠a. Te amar√© el resto de mi vida al m√°ximo, mi objetivo es solo intentar hacerte lo m√°s feliz que pueda. Tu sonrisa es lo m√°s bonito que he visto en mi vida, y no exagero, cuando sonr√≠es tanto que salen tus colmillos, cuando te ries tanto que tu nariz se estrecha un poco, es perfecto. Estar contigo se siente as√≠: como llegar a un lugar donde todo se siente como un juego como una pel√≠cula, no tengo que fingir, solo estoy feliz y disfrutando de todo. Solo me haces sentirme yo de verdad, y eres la √∫nica que me hace sentir tan especial, y √∫nico.</p>

            <p>Me encanta c√≥mo haces que lo normal y aburrido se vuelva interesante y divertido sin darte cuenta. Me gusta cuando estamos en tu casa y de repente te vuelves loca y te pones a cantar, cuando pegas un salto del sof√° y te pones a bailar como un pirada. Cuando me metes un chillido, me encanta esa parte de t√≠ m√°s agitada y loca. Al igual que tambien me encanta tu ser mas tranquilo, mas de estar tumbados sin hacer nada, juntos hablando, me gusta cuando te hago sentir sobre estimulada, JAJA s√© que a ti en ese momento te dan ganas de matarme, pero ya sabes que como fan y como hater me encanta hacerte picar.</p>

            <p>No eres perfecta porque no tengas defectos, lo eres porque eres real y sincera. Porque sientes, porque te esfuerzas, porque dudas, porque quieres bien. Y porque incluso en los momentos dif√≠ciles sigues eligiendo quedarte conmigo y seguir construyendo esta relaci√≥n junto a mi. Eso, Ali, es de las cosas que m√°s admiro y m√°s me gustan de ti, porque s√© y entiendo lo que se siente cuando hemos estado en esta racha mala, es por eso que te siento tan fuertemente junto a mi y deseo con todo mi coraz√≥n poder seguir disfrutando del resto de mi vida de la mano contigo. Contigo he aprendido que el amor no siempre hace ruido, a veces simplemente calma, acompa√±a. Y creo que tienes un don con tu calma y forma de escuchar a la gente que hasta a veces me siento mal por no poder ser as√≠ como t√∫.</p>

            <p>Gracias por tu paciencia conmigo en serio, por mirarme como si vieras en m√≠ cosas que a veces ni yo veo. Gracias por hacerme querer mejorar no por miedo a pensar que te puedo perder, sino por ganas de estar a tu altura porque aunque no te lo creas, para m√≠ T√ö eres la persona a la que considero mi S√çMBOLO, a qu√© me refiero con ‚Äús√≠mbolo‚Äù, eres la persona a la que aspiro a ser en la gran mayor√≠a de aspectos de la vida, tu empat√≠a, tu calma, tu forma de afrontar muchos problemas, tu capacidad de entender a la gente a la primera, tu aspecto f√≠sico tambi√©n porque me pareces la persona m√°s atractiva del mundo y la chica con mejor estilo del planeta. Gracias por ser mi novia, mi mejor amiga y esa persona a la que siempre quiero contarle todo primero.</p>

            <p>No s√© c√≥mo ser√° nuestro futuro, pero s√≠ s√© algo con absoluta certeza y claridad: quiero vivirlo contigo TODO. Aprender a quererte mejor, entenderte mejor, aprender que te gusta, aprender qu√© necesitas en cada momento, poder leerte como a un libro, crecer a tu lado, re√≠rnos de nuestras tonter√≠as y apoyarnos cuando la vida apriete y sea m√°s dif√≠cil. Si alg√∫n d√≠a dudas, quiero que recuerdes esto: yo te eleg√≠ cuando me fij√© en t√≠ por primera vez, cuando me enamor√© de ti y todos los d√≠as de mi vida, y te seguir√© eligiendo el resto de mi vida, porque no existe nada o nadie que sea un 0,00000001 * 10^ a un googleplex que se te acerque a ti. Te elegir√© hoy, ma√±ana y todas las veces que haga falta.</p>

            <p>Este San Valent√≠n no quiero prometer cosas imposibles, solo algo muy sencillo e importante para mi: cuidarte, escucharte, hacerte sentir c√≥moda y quererte de la mejor forma que s√©. Porque para mi amarte no es algo complicado, al contrario, es lo m√°s natural y f√°cil que hago, porque eres la mejor chica de mi MUNDO.</p>

            <p>Gracias por existir.</p>
            <p>Gracias por ser mi lugar seguro.</p>
            <p>Gracias por ser tal y como eres.</p>
            <p>Te quiero, Ali.</p>

            <p>Y me siento inmensamente afortunado de que seas t√∫, de verdad que no sabes cuan afortunado me siento teniendote a ti a mi lado.</p>

            <p>Eres m√°s de lo que podr√≠a pedir y eres m√°s de lo que esperaba alguna vez encontrar.</p>

            <p>Te amo Alicia üíô</p>
          </div>

          <img class="relation-photo" src="./foto7.jpeg" alt="Foto nuestra" />
        </div>
      </div>
    </section>

  </main>

  <!-- NAVEGACI√ìN -->
  <nav class="pager" aria-label="Navegaci√≥n">
    <button id="prevBtn" class="btn btn-ghost" type="button">Anterior</button>

    <div class="page-indicator">
      <span id="pageTitle">Empezar</span>
      <span class="dot">¬∑</span>
      <span id="pageCounter">1/1</span>

      <button id="soundBtn" class="btn btn-ghost btn-sound" type="button" aria-pressed="false" title="Activar/Desactivar sonido">
        üîà OFF
      </button>
    </div>

    <button id="nextBtn" class="btn btn-primary" type="button">Siguiente</button>
  </nav>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const pages = Array.from(document.querySelectorAll(".page"));
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const startBtn = document.getElementById("startBtn");
      const pageTitle = document.getElementById("pageTitle");
      const pageCounter = document.getElementById("pageCounter");

      // Flip cards
      const flipCards = Array.from(document.querySelectorAll("[data-flip]"));

      // Easter egg portada
      const coverEasterEgg = document.getElementById("coverEasterEgg");

      // Sonido
      const soundBtn = document.getElementById("soundBtn");
      let soundEnabled = false;
      let audioCtx = null;

      function ensureAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === "suspended") audioCtx.resume();
      }

      function beep({ freq = 440, dur = 0.06, type = "sine", gain = 0.035 } = {}) {
        if (!soundEnabled) return;
        ensureAudio();
        const t0 = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();

        osc.type = type;
        osc.frequency.setValueAtTime(freq, t0);

        g.gain.setValueAtTime(0.0001, t0);
        g.gain.exponentialRampToValueAtTime(gain, t0 + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

        osc.connect(g).connect(audioCtx.destination);
        osc.start(t0);
        osc.stop(t0 + dur + 0.02);
      }

      function noiseBurst({ dur = 0.10, gain = 0.02 } = {}) {
        if (!soundEnabled) return;
        ensureAudio();
        const bufferSize = Math.max(1, Math.floor(audioCtx.sampleRate * dur));
        const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
        }
        const src = audioCtx.createBufferSource();
        const g = audioCtx.createGain();
        g.gain.value = gain;
        src.buffer = buffer;
        src.connect(g).connect(audioCtx.destination);
        src.start();
      }

      const sfx = {
        slide() {
          beep({ freq: 260, dur: 0.05, type: "sine", gain: 0.028 });
          beep({ freq: 320, dur: 0.06, type: "sine", gain: 0.020 });
        },
        flip() {
          beep({ freq: 520, dur: 0.04, type: "triangle", gain: 0.020 });
        },
        confetti() {
          beep({ freq: 740, dur: 0.05, type: "square", gain: 0.015 });
          beep({ freq: 980, dur: 0.06, type: "square", gain: 0.012 });
          noiseBurst({ dur: 0.12, gain: 0.014 });
        }
      };

      soundBtn?.addEventListener("click", () => {
        soundEnabled = !soundEnabled;
        soundBtn.textContent = soundEnabled ? "üîä ON" : "üîà OFF";
        soundBtn.setAttribute("aria-pressed", String(soundEnabled));
        if (soundEnabled) beep({ freq: 440, dur: 0.05, gain: 0.02 }); // ‚Äúunlock‚Äù audio
      });

      let current = 0;

      function animateIn(pageEl, direction) {
        pageEl.classList.remove("slide-in-left", "slide-in-right");
        const cls = direction === "left" ? "slide-in-left" : "slide-in-right";
        pageEl.classList.add(cls);
        pageEl.addEventListener("animationend", () => pageEl.classList.remove(cls), { once: true });
      }

      function showPage(i) {
        const prev = current;
        const next = Math.max(0, Math.min(i, pages.length - 1));
        const direction = next > prev ? "right" : "left";
        current = next;

        pages.forEach((p, idx) => {
          p.classList.toggle("active", idx === current);
        });

        const title = pages[current].dataset.title || `P√°gina ${current + 1}`;
        pageTitle.textContent = title;
        pageCounter.textContent = `${current + 1}/${pages.length}`;

        // En la pantalla "Empezar", ocultamos botones de anterior/siguiente
        const onStart = current === 0;
        prevBtn.style.visibility = onStart ? "hidden" : "visible";
        nextBtn.style.visibility = onStart ? "hidden" : "visible";

        prevBtn.disabled = current === 0;
        nextBtn.disabled = current === pages.length - 1;

        // Slide in solo si no es el primer render
        if (prev !== current) {
          animateIn(pages[current], direction);
          sfx.slide();
        }

        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      startBtn?.addEventListener("click", () => showPage(1));
      prevBtn.addEventListener("click", () => showPage(current - 1));
      nextBtn.addEventListener("click", () => showPage(current + 1));

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") showPage(current - 1);
        if (e.key === "ArrowRight") showPage(current + 1);
      });

      // Flip cards
      flipCards.forEach(card => {
        card.addEventListener("click", () => {
          card.classList.toggle("flipped");
          sfx.flip();
        });
      });

      /********************
       * Confetti
       ********************/
      const confettiCanvas = document.getElementById("confetti");
      const cctx = confettiCanvas.getContext("2d");
      let confettiPieces = [];
      let confettiRunning = false;

      function resizeCanvas(canvas) {
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        canvas.width = Math.floor(canvas.clientWidth * dpr);
        canvas.height = Math.floor(canvas.clientHeight * dpr);
        return dpr;
      }

      function launchConfetti() {
        const dpr = resizeCanvas(confettiCanvas);
        const W = confettiCanvas.width;
        const H = confettiCanvas.height;

        const count = 180;
        confettiPieces = [];
        for (let i = 0; i < count; i++) {
          confettiPieces.push({
            x: Math.random() * W,
            y: -20 - Math.random() * H * 0.2,
            vx: (Math.random() * 2 - 1) * 1.8 * dpr,
            vy: (2 + Math.random() * 4) * dpr,
            r: (2 + Math.random() * 5) * dpr,
            rot: Math.random() * Math.PI,
            vr: (Math.random() * 2 - 1) * 0.12,
            hue: Math.floor(Math.random() * 360),
            life: 0,
            ttl: 240 + Math.floor(Math.random() * 60)
          });
        }

        confettiRunning = true;
        sfx.confetti();
        requestAnimationFrame(confettiTick);
        setTimeout(() => { confettiRunning = false; }, 2600);
      }

      function confettiTick() {
        if (!confettiRunning) {
          cctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
          return;
        }

        const W = confettiCanvas.width;
        const H = confettiCanvas.height;
        cctx.clearRect(0, 0, W, H);

        for (const p of confettiPieces) {
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vr;
          p.life++;

          if (p.x < -30) p.x = W + 30;
          if (p.x > W + 30) p.x = -30;

          const alpha = Math.max(0, 1 - p.life / p.ttl);
          cctx.save();
          cctx.translate(p.x, p.y);
          cctx.rotate(p.rot);
          cctx.globalAlpha = alpha;
          cctx.fillStyle = `hsl(${p.hue} 90% 60%)`;
          cctx.fillRect(-p.r, -p.r * 0.6, p.r * 2.2, p.r * 1.2);
          cctx.restore();
        }

        requestAnimationFrame(confettiTick);
      }

      // Easter egg: click en portada
      coverEasterEgg?.addEventListener("click", launchConfetti);

      /********************
       * Stars / Part√≠culas
       ********************/
      const starsCanvas = document.getElementById("stars");
      const sctx = starsCanvas.getContext("2d");
      let stars = [];

      function initStars() {
        const dpr = resizeCanvas(starsCanvas);
        const W = starsCanvas.width;
        const H = starsCanvas.height;

        const count = Math.floor((W * H) / (22000 * dpr * dpr));
        stars = [];
        for (let i = 0; i < count; i++) {
          stars.push({
            x: Math.random() * W,
            y: Math.random() * H,
            z: 0.4 + Math.random() * 0.9,
            r: (0.6 + Math.random() * 1.8) * dpr,
            vy: (0.10 + Math.random() * 0.35) * dpr,
            tw: Math.random() * Math.PI * 2
          });
        }
      }

      function starsTick() {
        const W = starsCanvas.width;
        const H = starsCanvas.height;

        sctx.clearRect(0, 0, W, H);

        // haze ligero
        sctx.fillStyle = "rgba(255,255,255,0.02)";
        sctx.fillRect(0, 0, W, H);

        for (const st of stars) {
          st.y += st.vy * st.z;
          if (st.y > H + 10) {
            st.y = -10;
            st.x = Math.random() * W;
          }
          st.tw += 0.03;

          const a = 0.35 + 0.35 * Math.sin(st.tw);
          sctx.beginPath();
          sctx.fillStyle = `rgba(234,240,255,${a})`;
          sctx.arc(st.x, st.y, st.r * st.z, 0, Math.PI * 2);
          sctx.fill();
        }

        requestAnimationFrame(starsTick);
      }

      function onResize() {
        initStars();
        resizeCanvas(confettiCanvas);
      }
      window.addEventListener("resize", onResize);

      onResize();
      starsTick();

      showPage(0);
    });
  </script>
</body>
</html>





